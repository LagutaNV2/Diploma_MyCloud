### –î–∏–ø–ª–æ–º–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –ø–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ ¬´Fullstack-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ Python¬ª
## –û–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ My Cloud (—Å–µ—Ä–≤–µ—Ä)

ip-–∞–¥—Ä–µ—Å: [http://89.104.71.24]

frontend: [https://github.com/LagutaNV2/Diploma_MyCloud_frontend]



## **–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ (Reg.ru) –Ω–∞ –æ—Å–Ω–æ–≤–µ:**

- Ubuntu
- Nginx (–∫–∞–∫ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä –∏ –æ–±—Ä–∞—Ç–Ω—ã–π –ø—Ä–æ–∫—Å–∏)
- Gunicorn (–¥–ª—è –∑–∞–ø—É—Å–∫–∞ Django-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
- PostgreSQL (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)

## –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (System Requirements)
–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞:

–û–°: Ubuntu 22.04 LTS

–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä: 1 —è–¥—Ä–æ (x86_64)

–ü–∞–º—è—Ç—å: 1 –ì–ë RAM

–î–∏—Å–∫–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ: 10 –ì–ë (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–∏—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞)

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:

PostgreSQL 14+
Python 3.10+
Nginx 1.18+
Node.js 18+ (–¥–ª—è —Å–±–æ—Ä–∫–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞)

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:

1vCPU, 1 –ì–ë RAM, 10–ì–ë SSD-–¥–∏—Å–∫

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã (System Limits)
–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:

–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: 1 –ú–ë

(–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ Django,
–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ File: storage/serializers.py –∏ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º —Ñ–∞–π–ª–µ Nginx )

–û–±—â–∏–π –æ–±—ä–µ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–∞: 10 –ì–ë (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–∏—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞)

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É (–ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è):

http://–≤–∞—à-ip/api/docs/


## –°—Ö–µ–º–∞ –ø—Ä–æ–µ–∫—Ç–∞:
/var/www/my_cloud/

‚îú‚îÄ‚îÄ backend/

‚îÇ   ‚îú‚îÄ‚îÄ venv/

‚îÇ   ‚îú‚îÄ‚îÄ staticfiles/    # collectstatic

‚îÇ   ‚îú‚îÄ‚îÄ storage_files/  # –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ñ–∞–π–ª—ã

‚îÇ   ‚îú‚îÄ‚îÄ .env            # production settings

‚îÇ   ‚îî‚îÄ‚îÄ ...             # –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥


‚îî‚îÄ‚îÄ frontend/

    ‚îú‚îÄ‚îÄ dist/           # —Å–æ–±—Ä–∞–Ω–Ω—ã–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥

    ‚îî‚îÄ‚îÄ .env.production # production env vars


## –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π:

–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞:
- –ö–ª—é—á–∏ –∏ –∑–∞–∫–∞–∑ —Å–µ—Ä–≤–µ—Ä–∞
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–∞–∫–µ—Ç–æ–≤ (Python, pip, PostgreSQL, Nginx –∏ —Ç.–¥.)

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL:
- –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è Django-–ø—Ä–æ–µ–∫—Ç–∞

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∫–µ–Ω–¥–∞ (Django):
- –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Ñ–∞–π–ª .env) –¥–ª—è production
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π, —Å–±–æ—Ä —Å—Ç–∞—Ç–∏–∫–∏, —Å–æ–∑–¥–∞–Ω–∏–µ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞:
- –°–±–æ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –≤ production-—Ä–µ–∂–∏–º–µ
- –†–∞–∑–º–µ—â–µ–Ω–∏–µ —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –æ—Ç–∫—É–¥–∞ backend –±—É–¥–µ—Ç —Ä–∞–∑–¥–∞–≤–∞—Ç—å —Å—Ç–∞—Ç–∏–∫—É

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Gunicorn:
- –°–æ–∑–¥–∞–Ω–∏–µ systemd-—Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ Gunicorn

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx:
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx –¥–ª—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ –∏ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Gunicorn
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º (SPA) –∏ API –±–µ–∫–µ–Ω–¥–∞



## –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –¥–µ–ø–ª–æ—è –Ω–∞ REG.RU
1.	–ó–∞–∫–∞–∂–∏—Ç–µ –Ω–∞ —Ä–µ–≥.—Ä—É VPS —Å–µ—Ä–≤–µ—Ä.

2. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É –ø–æ SSH:

   2.1. –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ:
   ```
    ssh-keygen -t rsa
    cat ~/.ssh/id_rsa.pub
   ```
   2.2. —Å–æ–∑–¥–∞–π—Ç–µ –∫–ª—é—á –Ω–∞ —Ä–µ–≥.—Ä—É *(–¥–∞–π—Ç–µ –∏–º—è –∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ)*

   2.3. –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É *(—Ç–µ—Ä–º–∏–Ω–∞–ª –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ)*:
  ```
    ssh root@ip-adress
  ```
3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∞–∑–æ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:
   ```
    sudo apt update && sudo apt upgrade -y

    sudo apt install -y git nginx libpq-dev python3-pip

    sudo apt install -y python3 python3-venv python3-dev

    sudo apt install -y postgresql postgresql-contrib


4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL
   ```
    sudo -u postgres psql
    CREATE DATABASE mycloud_db;
    CREATE USER mycloud_user WITH PASSWORD 'your_password';
    ALTER ROLE mycloud_user SET client_encoding TO 'utf8';
    ALTER ROLE mycloud_user SET default_transaction_isolation TO 'read committed';
    ALTER ROLE mycloud_user SET timezone TO 'Europe/Moscow';
    GRANT CREATE ON SCHEMA public TO mycloud_user;
    GRANT ALL PRIVILEGES ON DATABASE mycloud_db TO mycloud_user;
    GRANT ALL PRIVILEGES ON SCHEMA public TO mycloud_user;
    GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO mycloud_user;
    GRANT ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA public TO mycloud_user;
    \q

5. –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞:
    *(–∑–¥–µ—Å—å www=django->adduser django)*

    adduser www

    usermod -aG sudo www *(usermod -aG sudo django)*

    sudo su www *(sudo su django)*

   –°–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –Ω–µ–µ *(–Ω–∞–ø—Ä–∏–º–µ—Ä, mkdir /home/django/my_cloud/backend)*:
   ```
    mkdir -p ~/my_cloud
    mkdir ~/my_cloud/backend
    cd ~/my_cloud/backend


6. –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º backend (Django)

    6.1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è Git  –≤ –ø–∞–ø–∫—É my_cloud/backend:

        git clone https://github.com/LagutaNV2/Diploma_MyCloud_backend.git .


    6.2. –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:

        python3 -m venv venv
        source venv/bin/activate
        pip install -r requirements.txt


    6.3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Django

      6.3.1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª '.env' –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤ my_cloud/backend:

        nano .env

        —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:

            ENVIRONMENT=production
            DEBUG=False
            SECRET_KEY=your_production_secret_key_here
            ALLOWED_HOSTS=your_server_ip
            DB_NAME=your_production_db_name
            DB_USER=your_production_db_user
            DB_PASSWORD=your_production_password
            DB_HOST=localhost
            DB_PORT=5432
            STORAGE_PATH=/var/www/my_cloud/storage_files
                # /home/django/my_cloud/storage_files
            CORS_ALLOWED_ORIGINS=http://–≤–∞—à-ip,http://localhost:3000

      6.3.2. –§–∞–π–ª `config/settings.py` –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ, –Ω–æ –µ—Å–ª–∏ –µ—Å—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å, –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ:

            sudo chown django:django config/settings.py
            nano config/settings.py


      6.3.3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ —Å–æ–±–µ—Ä–∏—Ç–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã —Å–µ—Ä–≤–µ—Ä–∞:

            python manage.py makemigrations
            python manage.py migrate
            python manage.py collectstatic


      6.3.4. –°–æ–∑–¥–∞–π—Ç–µ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–Ω–µ–ª–∏:

            python manage.py createsuperuser


7.  –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Gunicorn (–∑–¥–µ—Å—å - –¥–ª—è –ø—É—Ç–∏: "/home/django/my_cloud/backend")

    7.1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Gunicorn

        pip install gunicorn

    7.2. –í –∫–æ—Ä–Ω–µ backend —Å–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è Gunicorn:

        sudo nano /etc/systemd/system/gunicorn.service

    7.3. –î–æ–±–∞–≤–∏–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ, –æ–±—Ä–∞—â–∞—è –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –ø—É—Ç–∏, –∏–º—è –ø—Ä–æ–µ–∫—Ç–∞ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

            [Unit]
            Description=Gunicorn for Cloud Storage Django "My cloud"
            After=network.target

            [Service]
            User=django

            Group=django

            WorkingDirectory=/home/django/my_cloud/backend

            Environment="PATH=/home/django/my_cloud/backend/venv/bin"

            ExecStart=/home/django/my_cloud/backend/venv/bin/gunicorn \
                    --workers 3 \
                    --bind': 'unix:/home/django/my_cloud/backend/gunicorn.sock'
                    --forwarded-allow-ips="*"\                      --access-logfile - \
                    config.wsgi:application

            Restart=always
            UMask=0007

            [Install]
            WantedBy=multi-user.target

    7.4. –æ–±–Ω–æ–≤–∏—Ç–µ –ø—Ä–∞–≤–∞:

        sudo chown django:django /home/django/my_cloud/backend
        sudo chmod 755 /home/django/my_cloud/backend

    7.5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∏ –≤–∫–ª—é—á–∏—Ç–µ —Å–µ—Ä–≤–∏—Å:

        sudo systemctl daemon-reload
        sudo systemctl start gunicorn
        sudo systemctl enable gunicorn

8.  –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º frontend (React) *(–∑–¥–µ—Å—å - –¥–ª—è –ø—É—Ç–∏: "/home/django/my_cloud/frontend")*

    8.1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è [Git https://github.com/LagutaNV2/Diploma_MyCloud_backend] –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É.

    8.2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–æ–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç:

            npm install
            npm run build

    8.3. –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É /home/django/frontend –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ –∫–æ–ø–∏—Ä—É–µ–º —Å—Ç–∞—Ç–∏–∫—É –∏–∑ –ø–∞–ø–∫–∏ dist –Ω–∞ —Å–µ—Ä–≤–µ—Ä, –ø–æ—Å–ª–µ —á–µ–≥–æ –æ–Ω–∞ –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ HTML, JS –∏ CSS —Ñ–∞–π–ª—ã:

      –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

        mkdir ~/my_cloud/frontend

      –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ (–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ):

        scp -r dist/* root@–≤–∞—à-ip:/home/django/my_cloud/frontend/dist


    8.4. –°–æ–∑–¥–∞–Ω–∏–µ .env.production –≤ –ø–∞–ø–∫–µ /home/django/my_cloud/frontend:

        nano .env.production

        —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:

            API_BASE_URL=http://–≤–∞—à-ip/api
            DEBUG=false
            PUBLIC_PATH=/
            NODE_ENV=production
            GENERATE_SOURCEMAP=false

    8.5. –ø–¥–æ—Å—Ç–∞–≤—å—Ç–µ –ø–æ–¥–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–∞–≤–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å dist:

            sudo chmod -R 755 /home/django/my_cloud/frontend/dist
            sudo chown -R django:www-data /home/django/my_cloud/frontend/dist


9.    –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx

    9.1. –°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è Nginx:

        sudo nano /etc/nginx/sites-available/my_cloud


    9.2. –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞:

        ```
        server {
            listen 80;
            listen [::]:80;

            # –í–∞—à IP-–∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞
            server_name –≤–∞—à-ip-–∞–¥—Ä–µ—Å –≤–∞—à-–¥–æ–º–µ–Ω;

            # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤ (—É–≤–µ–ª–∏—á—å—Ç–µ, –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ)
            client_max_body_size 1M;

            error_page 413 @413_json;
            location @413_json {
                add_header Content-Type application/json;
                return 413 '{"file": ["–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–ø—Ä–µ–≤—ã—à–∞–µ—Ç 1 MB). –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 1 MB"]}';
            }

            # –ö–æ—Ä–µ–Ω—å –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
            root /var/www/my_cloud/frontend/dist;

            # –°—Ç–∞—Ç–∏–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
            location / {
                try_files $uri $uri/ /index.html;
                add_header Cache-Control "no-cache, no-store, must-revalidate";
                add_header Pragma "no-cache";
                add_header Expires "0";
            }

            # –°—Ç–∞—Ç–∏–∫–∞ Django (admin, DRF)
            location /static/ {
                alias /var/www/my_cloud/backend/staticfiles/;
                expires 30d;
                access_log off;
            }

            # –ú–µ–¥–∏–∞—Ñ–∞–π–ª—ã (–∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏)
            location /storage/ {
                alias /var/www/my_cloud/backend/storage_files/;
                expires 30d;
                access_log off;
            }

            # API endpoints
            location /api/ {
                add_header X-Debug-Host $host;
                proxy_pass http://unix:/home/django/my_cloud/backend/gunicorn.sock;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Proto $scheme;

                # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ - –æ—á–∏—Å—Ç–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
                proxy_set_header X-Forwarded-Host $server_name;proxy_set_header X-Original-Host "";

                proxy_redirect off;
                proxy_buffering off;

                # –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–æ–≤ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
                proxy_connect_timeout 300s;
                proxy_send_timeout 300s;
                proxy_read_timeout 300s;
                send_timeout 300s;

                #  –¥–æ–±–∞–≤—å—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∫—É CORS
                add_header 'Access-Control-Allow-Origin' 'http://89.104.71.24' always;
                add_header 'Access-Control-Allow-Credentials' 'true' always;
            }

            # Django admin
            location /admin/ {
                include proxy_params;
                proxy_pass http://unix:/var/www/my_cloud/backend/gunicorn.sock;
                (–∏–ª–∏ proxy_pass http://unix:/tmp/gunicorn.sock;)
            }

            # Health check endpoint
            location /health/ {
                include proxy_params;
                proxy_pass http://unix:/var/www/my_cloud/backend/gunicorn.sock;
                (–∏–ª–∏ proxy_pass http://unix:/tmp/gunicorn.sock;)
            }

            # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
            error_page 500 502 503 504 /50x.html;
            location = /50x.html {
                root /usr/share/nginx/html;
            }
        }
        ```


    9.3. –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:

        sudo ln -s /etc/nginx/sites-available/my_cloud /etc/nginx/sites-enabled/
        sudo nginx -t
        sudo systemctl restart nginx


10.  –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

    –ü—Ä–æ–≤–µ—Ä–∫–∞ Gunicorn:

        sudo systemctl status gunicorn
        journalctl -u gunicorn --since "5 minutes ago"

    –ü—Ä–æ–≤–µ—Ä–∫–∞ Nginx:

        sudo systemctl status nginx
        tail -f /var/log/nginx/error.log

    –¢–µ—Å—Ç–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã:

        –ü—Ä–æ–≤–µ—Ä–∫–∞ API

            curl http://–≤–∞—à Ip/health/

        –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

            curl -I http://–≤–∞—à Ip

        –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ

          - –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ –∞–¥—Ä–µ—Å—É `http://–≤–∞—à Ip`.
          - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–æ–µ–∫—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.
          - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—É—é –ø–∞–Ω–µ–ª—å –ø–æ –∞–¥—Ä–µ—Å—É `http://–≤–∞—à Ip/admin`.

11. –ö–æ–º–∞–Ω–¥—ã –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ VSR ip 89.104.71.24:
    win + R
    wsl

   ```
    ssh django@89.104.71.24
    source ~/my_cloud/backend/venv/bin/activate

    sudo systemctl daemon-reload

    sudo systemctl start gunicorn
    sudo systemctl enable gunicorn
    sudo systemctl status gunicorn

    sudo nginx -t
    sudo systemctl start nginx
    sudo systemctl enable nginx
    sudo systemctl restart nginx
    sudo systemctl status nginx

    –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–ª—É–∂–±:
    sudo systemctl daemon-reload
    sudo systemctl restart gunicorn
    sudo systemctl restart nginx

    –ø—Ä–æ–≤–µ—Ä–∫–∞:
    sudo systemctl status gunicorn
    sudo systemctl status nginx
    journalctl -u gunicorn
    sudo tail -f /var/log/nginx/error.log
    tail -f /home/django/my_cloud/backend/logs/django_debug.log

    curl http://89.104.71.24/health/
    http://89.104.71.24
```


# –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞–º–ø–∞ –ë–î
### 1. –ß—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É:

```
   sudo -u postgres pg_dump -U mycloud_user -h localhost -d mycloud_db > backup_$(date +%Y-%m-%d).sql
```

, –≥–¥–µ
  mycloud_user -  –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö;
  mycloud_db - –∏–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö;
  $(date +%Y-%m-%d) - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –≤ –∏–º—è —Ñ–∞–π–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `backup_2023-10-05.sql`) –¥–ª—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—ã–≤–æ–¥–∞ –≤ —Ñ–∞–π–ª —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –∏–º–µ–Ω–µ–º.


### 2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏:

```
   sudo -u postgres psql -U mycloud_user -h localhost -d mycloud_db < backup_2025-07-25.sql
```
, –≥–¥–µ < backup_2025-07-25.sql -  –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–∞ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.

### 3. **–í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è**
–í—ã–ø–æ–ª–Ω—è–π—Ç–µ –¥–∞–º–ø –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–µ–¥ –∫—Ä—É–ø–Ω—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö).

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –≤—ã–ø–æ–ª–Ω—è—é—â–∏–π –∫–æ–º–∞–Ω–¥—ã, –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤.

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ –∏–ª–∏ –æ–±–ª–∞—á–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö —Å–±–æ–µ–≤.

–†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ, —á—Ç–æ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏ –º–æ–≥—É—Ç –±—ã—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã.




## üõ† Troubleshooting

### 1. –û—à–∏–±–∫–∞ 502 Bad Gateway
**–°–∏–º–ø—Ç–æ–º—ã:**
- Nginx –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É 502
- Gunicorn –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
```
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å Gunicorn
sudo systemctl status gunicorn

# –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ Gunicorn
journalctl -u gunicorn --since "5 minutes ago"

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–ª—É–∂–±—É
sudo systemctl restart gunicorn
```

### 2. –û—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

–°–∏–º–ø—Ç–æ–º—ã:

Django –≤—ã–¥–∞–µ—Ç –æ—à–∏–±–∫–∏ –≤–∏–¥–∞ "could not connect to server"

–ú–∏–≥—Ä–∞—Ü–∏–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è.


**–†–µ—à–µ–Ω–∏–µ:**
```
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å PostgreSQL

sudo systemctl status postgresql

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

sudo -u postgres psql -c "\l"
sudo -u postgres psql -c "GRANT ALL PRIVILEGES ON DATABASE mycloud_db TO mycloud_user;"
```

### 3. –ü—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–≥—Ä—É–∑–∫–æ–π —Ñ–∞–π–ª–æ–≤
–°–∏–º–ø—Ç–æ–º—ã:

–û—à–∏–±–∫–∞ 413 Request Entity Too Large

–§–∞–π–ª—ã –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```
–£–≤–µ–ª–∏—á—å—Ç–µ –ª–∏–º–∏—Ç –≤ Nginx:

nginx
# –í /etc/nginx/sites-available/my_cloud
client_max_body_size 500M;

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Nginx:

sudo systemctl restart nginx
```

### 4. –ü—Ä–æ–±–ª–µ–º—ã —Å CORS
–°–∏–º–ø—Ç–æ–º—ã:

–ë—Ä–∞—É–∑–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ API

–û—à–∏–±–∫–∏ "Blocked by CORS policy"

**–†–µ—à–µ–Ω–∏–µ:**
```
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ .env:

CORS_ALLOWED_ORIGINS=http://–≤–∞—à-ip,http://localhost:3000

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Gunicorn:

sudo systemctl restart gunicorn

```

### 5. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É drf-spectacular

source venv/bin/activate
pip list | grep drf-spectacular

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å—Ö–µ–º—ã

curl http://localhost/api/schema/



### 6. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞

**–†–µ—à–µ–Ω–∏–µ:**

```
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ
df -h


# –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π

```
find /backups -name "*.sql" -mtime +30 -delete
```
